/*! openvod | emma | ISC */
"use strict";!function(){angular.module("openvod",["ui.router","pascalprecht.translate","app.controllers","app.filters","app.directives","app.services","angular-md5","ngCookies","ngTable","ui.bootstrap","ui.bootstrap.datetimepicker","highcharts-ng"]).config(["$translateProvider",function(a){var b=navigator.language.indexOf("zh")>-1?"zh-CN":"en-US";a.preferredLanguage(b),a.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/login"),a.state("login",{url:"/login",templateUrl:"pages/login.html"}).state("app",{url:"/app",templateUrl:"pages/app.html"}).state("app.home",{url:"/home",templateUrl:"pages/home.html"}).state("app.overview",{url:"/overview",templateUrl:"pages/overview.html"}).state("app.specific",{url:"/specific",templateUrl:"pages/specific.html"}).state("app.event",{url:"/event",templateUrl:"pages/event.html"}).state("app.funnel",{url:"/funnel",templateUrl:"pages/funnel.html"})}]).constant("CONFIG",{serverUrl:"http://192.168.30.100/backend_clearmgt/",uploadImgUrl:"http://mres.cleartv.cn/upload",uploadVideoUrl:"http://movies.clearidc.com/upload",testUrl:"test/",test:!1})}(),function(){angular.module("app.controllers",[]).controller("indexController",["$scope",function(a){this.init=function(){this.maskUrl=""}}]).controller("loginController",["$scope","$http","$state","$filter","md5","util",function(a,b,c,d,e,f){var g=this;g.init=function(){},g.login=function(){g.loading=!0;var a=JSON.stringify({username:g.userName,password:e.createHash(g.password)});b({method:"POST",url:f.getApiUrl("v1/logon","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(f.setParams("token",b.token),g.getEditLangs()):alert(b.rescode+" "+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})},g.getEditLangs=function(){b({method:"GET",url:f.getApiUrl("","editLangs.json","local")}).then(function(a){f.setParams("editLangs",a.data.editLangs),c.go("app.home")},function(a){})}}]).controller("appController",["$http","$scope","$state","$stateParams","$q","util","CONFIG",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.maskUrl="",h.maskParams={},b.granularity=[{id:0,name:"小时"},{id:1,name:"日"},{id:2,name:"周"},{id:3,name:"月"},{id:4,name:"年"}],b.getProject(),b.durationList=[3,4,5,6,7,8,9,10,11,12,24]},h.showHideMask=function(a,c){a?(b.app.maskUrl=c,b.app.showMaskClass=!0):(b.app.maskUrl="",b.app.showMaskClass=!1)},b.dtSubstr=function(a,b){switch(b){case 0:return a.substring(5,16);case 1:return a.substring(5,10);case 2:return a.substring(5,10);case 3:return a.substring(0,7);case 4:return a.substring(0,4)}},b.getProject=function(){var c=e.defer(),d=JSON.stringify({token:f.getParams("token"),action:"projectNameList"});a({method:"POST",url:f.getApiUrl("v1/project","","server"),data:d}).then(function(a){var d=a.data;"200"==d.rescode?(b.app.projectList=[],b.app.projectList[0]={projectName:"all",projectNameCHZ:"所有项目"},d.data.forEach(function(a){b.app.projectList.push({projectName:a.ProjectName,projectNameCHZ:a.ProjectNameCHZ})}),b.app.selectProject="all",f.setParams("project","all"),c.resolve()):(alert(d.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){})}}]).controller("homeController",["$http","$scope","$state","$location","$filter","$stateParams","$q","util","CONFIG",function(a,b,c,d,e,f,g,h,i){var j=this;j.init=function(){j.projectList=[{projectName:"OpenVoD",projectNameCHZ:"OpenVoD"}],j.selectProject="OpenVoD"},j.logout=function(){h.setParams("token",""),c.go("login")}}]).controller("overviewController",["$http","$scope","$state","$location","$filter","$stateParams","$q","util","CONFIG",function(a,b,c,d,e,f,g,h,i){function j(){b.$broadcast("end-date-changed"),l.loadChart()}function k(a){if(b.dateRangeEnd){var c=moment(b.dateRangeEnd);a.filter(function(a){return a.localDateValue()>=c.valueOf()}).forEach(function(a){a.selectable=!1})}}var l=this;moment.locale("zh-cn"),b.endDateBeforeRender=k,b.endDateOnSetTime=j,l.init=function(){l.activerow=0,b.dateRangeEnd=e("date")(new Date+864e5,"yyyy-MM-dd"),l.searchDate=e("date")((new Date).getTime(),"yyyy-MM-dd"),l.selectGra=1,l.isDate=!0,l.selectDur=7,l.loadChart()},l.isCurrent=function(a){l.activerow!=a&&(l.activerow=a,l.loadChart())},l.changeGra=function(a){0==a?(l.isDate=!1,10==l.searchDate.length&&(l.searchDate+=" 00:00")):(l.isDate=!0,16==l.searchDate.length&&(l.searchDate=l.searchDate.substring(0,10))),l.loadChart()},l.changeProject=function(a){h.setParams("project",a),l.loadChart()},l.charts={chart:{type:"areaspline"},title:{text:""},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:[]},yAxis:{title:{text:""}},tooltip:{shared:!0,valueSuffix:""},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[]},l.loadChart=function(){function c(){var b=JSON.stringify({token:h.getParams("token"),action:"getTermActiveRateInfo",endTime:10==l.searchDate.length?l.searchDate+" 00:00:00":l.searchDate+":00",project:[h.getParams("project")],timespans:l.selectDur,type:l.selectGra});a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(l.th.push("活跃率"),l.charts.series.push({name:"活跃率",id:"series-1",data:[],tooltip:{valueSuffix:"%"}}),b.activeRate.forEach(function(a,b){b<7&&l.charts.series[1].data.push(100*a),l.dataSet[b].c=100*a+"%"}),d.resolve()):(alert(b.errInfo),d.reject())},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){l.loadingChart0=!1})}var d=g.defer();switch(l.activerow){case 0:!function(){l.charts.yAxis.title.text="百分比 %";var e=JSON.stringify({token:h.getParams("token"),action:"getTermOnlineRateInfo",endTime:10==l.searchDate.length?l.searchDate+" 00:00:00":l.searchDate+":00",project:[h.getParams("project")],timespans:l.selectDur,type:l.selectGra});l.loadingChart0=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:e}).then(function(a){var c=a.data;return"200"==c.rescode?(l.th=["日期","开机率"],l.dataSet=[],l.charts.xAxis.categories=[],l.charts.series=[],c.timeList.forEach(function(a,c){c<7&&l.charts.xAxis.categories.push(b.dtSubstr(a,l.selectGra)),l.dataSet.push({a:b.dtSubstr(a,l.selectGra)})}),l.charts.series.push({name:"开机率",id:"series-0",data:[],tooltip:{valueSuffix:"%"}}),c.onlineRate.forEach(function(a,b){b<7&&l.charts.series[0].data.push(100*a),l.dataSet[b].b=100*a+"%"}),d.resolve()):(alert(c.errInfo),d.reject()),d.promise},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){c()})}();break;case 1:!function(){l.charts.yAxis.title.text="付费转化率 %",l.charts.tooltip.valueSuffix=" %";var c=JSON.stringify({token:h.getParams("token"),action:"getPayRateInfo",endTime:10==l.searchDate.length?l.searchDate+" 00:00:00":l.searchDate+":00",project:[h.getParams("project")],timespans:l.selectDur,type:l.selectGra});l.loadingChart1=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var c=a.data;"200"==c.rescode?(l.th=["日期","付费终端转化率","付费次数转化率"],l.dataSet=[],l.charts.xAxis.categories=[],l.charts.series=[],c.timeList.forEach(function(a,c){c<7&&l.charts.xAxis.categories.push(b.dtSubstr(a,l.selectGra)),l.dataSet.push({a:b.dtSubstr(a,l.selectGra)})}),l.charts.series.push({name:"付费终端转化率",data:[],tooltip:{valueSuffix:"%"}}),c.payRate.forEach(function(a,b){b<7&&l.charts.series[0].data.push(100*a),l.dataSet[b].b=100*a+"%"}),l.charts.series.push({name:"付费次数转化率",data:[],tooltip:{valueSuffix:"%"}}),c.payCountRate.forEach(function(a,b){b<7&&l.charts.series[1].data.push(100*a),l.dataSet[b].c=100*a+"%"}),d.resolve()):(alert(c.errInfo),d.reject())},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){l.loadingChart1=!1})}();break;case 2:!function(){l.charts.yAxis.title.text="平均每终端营收 元",l.charts.tooltip.valueSuffix=" 元";var c=JSON.stringify({token:h.getParams("token"),action:"getPerTermRevenueInfo",endTime:10==l.searchDate.length?l.searchDate+" 00:00:00":l.searchDate+":00",project:[h.getParams("project")],timespans:l.selectDur,type:l.selectGra});l.loadingChart2=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var c=a.data;"200"==c.rescode?(l.th=["日期","平均每终端营收"],l.dataSet=[],l.charts.xAxis.categories=[],l.charts.series=[],c.timeList.forEach(function(a,c){c<7&&l.charts.xAxis.categories.push(b.dtSubstr(a,l.selectGra)),l.dataSet.push({a:b.dtSubstr(a,l.selectGra)})}),l.charts.series.push({name:"平均每终端营收",data:[],tooltip:{valueSuffix:" 元"}}),c.revenue.forEach(function(a,b){b<7&&l.charts.series[0].data.push(a),l.dataSet[b].b=a}),d.resolve()):(alert(c.errInfo),d.reject())},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){l.loadingChart2=!1})}();break;case 3:!function(){l.charts.yAxis.title.text="平均活跃时长 小时";var c=JSON.stringify({token:h.getParams("token"),action:"getPerTermActiveTimeInfo",endTime:10==l.searchDate.length?l.searchDate+" 00:00:00":l.searchDate+":00",project:[h.getParams("project")],timespans:l.selectDur,type:l.selectGra});l.loadingChart3=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var c=a.data;"200"==c.rescode?(l.th=["日期","平均活跃时长"],l.dataSet=[],l.charts.xAxis.categories=[],l.charts.series=[],c.timeList.forEach(function(a,c){c<7&&l.charts.xAxis.categories.push(b.dtSubstr(a,l.selectGra)),l.dataSet.push({a:b.dtSubstr(a,l.selectGra)})}),l.charts.series.push({name:"平均活跃时长",data:[],tooltip:{valueSuffix:" 小时"}}),c.perActiveTime.forEach(function(a,b){function c(a){return a<10&&(a+="0"),a}b<7&&l.charts.series[0].data.push(Number((a/3600).toFixed(2)));var d=Math.floor(a/3600),e=Math.floor((a-3600*d)/60),f=(a-3600*d-60*e).toFixed(2);l.dataSet[b].b=d+":"+c(e)+":"+c(f)}),d.resolve()):(alert(c.errInfo),d.reject())},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){l.loadingChart3=!1})}()}return d.promise},l.changeOrderby=function(a){l.desc=!l.desc}}]).controller("specificController",["$http","$scope","$state","$location","$filter","$stateParams","$q","util","CONFIG",function(a,b,c,d,e,f,g,h,i){function j(){b.$broadcast("end-date-changed"),l.loadChart()}function k(a){if(b.dateRangeEnd){var c=moment(b.dateRangeEnd);a.filter(function(a){return a.localDateValue()>=c.valueOf()}).forEach(function(a){a.selectable=!1})}}var l=this;moment.locale("zh-cn"),b.endDateBeforeRender=k,b.endDateOnSetTime=j,l.init=function(){l.activerow=0,l.term=[{name:"累计终端",show:!0,sort:"",desc:!1},{name:"上线终端",show:!0,sort:"",desc:!1},{name:"活跃终端",show:!0,sort:"",desc:!1},{name:"付费终端",show:!1,sort:"",desc:!1},{name:"新增终端",show:!1,sort:"",desc:!1}],l.countStatistics=[{name:"付 费 次 数",show:!0,sort:"",desc:!1},{name:"准付费次数",show:!1,sort:"",desc:!1}],l.selectCount=3,l.other=[{name:"活跃时长",show:!0,sort:"",desc:!1},{name:"西塘票务",show:!1,sort:"",desc:!1}],b.dateRangeEnd=e("date")(new Date+864e5,"yyyy-MM-dd"),l.searchDate=e("date")((new Date).getTime(),"yyyy-MM-dd"),l.selectGra=1,l.isDate=!0,l.selectDur=7,l.loadChart(),l.orderby={},l.orderby.desc=!1},l.isCurrent=function(a){l.activerow!=a&&(l.activerow=a,l.loadChart())},l.changeProject=function(a){h.setParams("project",a),l.loadChart()},l.changeGra=function(a){0==a?(l.isDate=!1,10==l.searchDate.length&&(l.searchDate+=" 00:00")):(l.isDate=!0,16==l.searchDate.length&&(l.searchDate=l.searchDate.substring(0,10))),l.loadChart()},l.selectTerm=function(a){if(1==l.term[a].show&&l.selectCount>=2)l.selectCount--;else{if(1==l.term[a].show&&l.selectCount<2)return alert("最少选择1组数据！"),!1;if(!(0==l.term[a].show&&l.selectCount<3))return alert("最多只能选择3组显示！"),!1;l.selectCount++}l.term[a].show=!l.term[a].show,l.th=["日期"],l.charts.series=[];var b=0;l.term.forEach(function(a,c){1==a.show&&(l.th.push(a.name),l.termSeries[c].id="series-"+b,l.charts.series.push(l.termSeries[c]),b++)}),l.dataSet=[],l.termData.forEach(function(a,b){l.dataSet.push({a:a.a}),1==l.term[0].show&&(l.dataSet[b].b=a.b),1==l.term[1].show&&(l.dataSet[b].c=a.c),1==l.term[2].show&&(l.dataSet[b].d=a.d),1==l.term[3].show&&(l.dataSet[b].e=a.e),1==l.term[4].show&&(l.dataSet[b].f=a.f)})},l.selectCountStatistics=function(a){0==l.countStatistics[a].show&&(0==a?(l.countStatistics[0].show=!0,l.countStatistics[1].show=!1):(l.countStatistics[0].show=!1,l.countStatistics[1].show=!0)),1==l.countStatistics[0].show?(l.th=["日期","付费次数","付费次数(单次)","付费次数(打包)"],l.charts.series=l.paySeries,l.dataSet=l.payData):1==l.countStatistics[1].show&&(l.th=["日期","准付费次数","准付费次数(单次)","准付费次数(打包)"],l.charts.series=l.wantPaySeries,l.dataSet=l.wantPayData)},l.selectOther=function(a){l.other.forEach(function(a){a.show=!1}),l.other[a].show=!0},l.charts={chart:{type:"areaspline"},title:{text:""},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:[]},yAxis:{title:{text:""}},tooltip:{shared:!0,valueSuffix:""},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[]},l.loadChart=function(){var c=g.defer();switch(l.activerow){case 0:!function(){l.charts.yAxis.title.text="终端数 个",l.charts.tooltip.valueSuffix=" 个";var d=JSON.stringify({token:h.getParams("token"),action:"getTermStatisticsInfo",endTime:10==l.searchDate.length?l.searchDate+" 00:00:00":l.searchDate+":00",project:[h.getParams("project")],timespans:l.selectDur,type:l.selectGra});l.loadingChart0=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var d=a.data;if("200"==d.rescode){l.dataSet=[],l.charts.xAxis.categories=[],l.charts.series=[],l.termSeries=[],l.termData=[],d.timeList.forEach(function(a,c){c<7&&l.charts.xAxis.categories.push(b.dtSubstr(a,l.selectGra)),l.termData.push({a:b.dtSubstr(a,l.selectGra)})}),l.termSeries.push({name:"累计终端",data:[],tooltip:{valueSuffix:" 个"}}),d.addUpCount.forEach(function(a,b){b<7&&l.termSeries[0].data.push(a),l.termData[b].b=a}),l.termSeries.push({name:"上线终端",data:[],tooltip:{valueSuffix:" 个"}}),d.onlineCount.forEach(function(a,b){b<7&&l.termSeries[1].data.push(a),l.termData[b].c=a}),l.termSeries.push({name:"活跃终端",data:[],tooltip:{valueSuffix:" 个"}}),d.activeCount.forEach(function(a,b){b<7&&l.termSeries[2].data.push(a),l.termData[b].d=a}),l.termSeries.push({name:"付费终端",data:[]}),d.payCount.forEach(function(a,b){b<7&&l.termSeries[3].data.push(a),l.termData[b].e=a}),l.termSeries.push({name:"新增终端",data:[]}),d.newAddCount.forEach(function(a,b){b<7&&l.termSeries[4].data.push(a),l.termData[b].f=a}),l.th=["日期"];var e=0;l.term.forEach(function(a,b){1==a.show&&(l.th.push(a.name),l.termSeries[b].id="series-"+e,l.charts.series.push(l.termSeries[b]),e++)}),l.termData.forEach(function(a,b){l.dataSet.push({a:a.a}),1==l.term[0].show&&(l.dataSet[b].b=a.b),1==l.term[1].show&&(l.dataSet[b].c=a.c),1==l.term[2].show&&(l.dataSet[b].d=a.d),1==l.term[3].show&&(l.dataSet[b].e=a.e),1==l.term[4].show&&(l.dataSet[b].f=a.f)}),c.resolve()}else alert(d.errInfo),c.reject()},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){l.loadingChart0=!1}),c.promise}();break;case 1:!function(){l.charts.yAxis.title.text="次数 次",l.charts.tooltip.valueSuffix=" 次";var d=JSON.stringify({token:h.getParams("token"),action:"getPayCountStatisticsInfo",endTime:10==l.searchDate.length?l.searchDate+" 00:00:00":l.searchDate+":00",project:[h.getParams("project")],timespans:l.selectDur,type:l.selectGra});l.loadingChart1=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var d=a.data;"200"==d.rescode?(l.wantPaySeries=[],l.wantPayData=[],l.paySeries=[],l.payData=[],l.dataSet=[],l.charts.xAxis.categories=[],l.charts.series=[],d.timeList.forEach(function(a,c){c<7&&l.charts.xAxis.categories.push(b.dtSubstr(a,l.selectGra)),l.wantPayData.push({a:b.dtSubstr(a,l.selectGra)}),l.payData.push({a:b.dtSubstr(a,l.selectGra)})}),l.wantPaySeries.push({name:"准付费次数",id:"series-0",data:[],tooltip:{valueSuffix:" 次"}}),d.wantPayCount.forEach(function(a,b){b<7&&l.wantPaySeries[0].data.push(a),l.wantPayData[b].b=a}),l.wantPaySeries.push({name:"准付费次数(单次)",id:"series-1",data:[],tooltip:{valueSuffix:" 次"}}),d.wantPaySingleCount.forEach(function(a,b){b<7&&l.wantPaySeries[1].data.push(a),l.wantPayData[b].c=a}),l.wantPaySeries.push({name:"准付费次数(打包)",id:"series-2",data:[],tooltip:{valueSuffix:" 次"}}),d.wantPayPackageCount.forEach(function(a,b){b<7&&l.wantPaySeries[2].data.push(a),l.wantPayData[b].d=a}),l.paySeries.push({name:"付费次数",id:"series-0",data:[],tooltip:{valueSuffix:" 次"}}),d.payCount.forEach(function(a,b){b<7&&l.paySeries[0].data.push(a),l.payData[b].b=a}),l.paySeries.push({name:"付费次数(单次)",id:"series-1",data:[],tooltip:{valueSuffix:" 次"}}),d.paySingleCount.forEach(function(a,b){b<7&&l.paySeries[1].data.push(a),l.payData[b].c=a}),l.paySeries.push({name:"付费次数(打包)",id:"series-2",data:[],tooltip:{valueSuffix:" 次"}}),d.payPackageCount.forEach(function(a,b){b<7&&l.paySeries[2].data.push(a),l.payData[b].d=a}),1==l.countStatistics[0].show?(l.th=["日期","付费次数","付费次数(单次)","付费次数(打包)"],l.charts.series=l.paySeries,l.dataSet=l.payData):1==l.countStatistics[1].show&&(l.th=["日期","准付费次数","准付费次数(单次)","准付费次数(打包)"],l.charts.series=l.wantPaySeries,l.dataSet=l.wantPayData),c.resolve()):(alert(d.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){l.loadingChart1=!1}),c.promise}();break;case 2:!function(){l.charts.yAxis.title.text="营收 元",l.charts.tooltip.valueSuffix=" 元";var d=JSON.stringify({token:h.getParams("token"),action:"getRevenueStatisticsInfo",endTime:10==l.searchDate.length?l.searchDate+" 00:00:00":l.searchDate+":00",project:[h.getParams("project")],timespans:l.selectDur,type:l.selectGra});l.loadingChart2=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var d=a.data;"200"==d.rescode?(l.th=["日期","总收益","单次点播收益","打包点播收益"],l.dataSet=[],l.charts.xAxis.categories=[],l.charts.series=[],d.timeList.forEach(function(a,c){c<7&&l.charts.xAxis.categories.push(b.dtSubstr(a,l.selectGra)),l.dataSet.push({a:b.dtSubstr(a,l.selectGra)})}),l.charts.series.push({name:"总收益",data:[],tooltip:{valueSuffix:" 元"}}),d.totalMovieRevenue.forEach(function(a,b){b<7&&l.charts.series[0].data.push(a),l.dataSet[b].b=a}),l.charts.series.push({name:"单次点播收益",data:[],tooltip:{valueSuffix:" 元"}}),d.singleMovieRevenue.forEach(function(a,b){b<7&&l.charts.series[1].data.push(a),l.dataSet[b].c=a}),l.charts.series.push({name:"打包点播收益",data:[],tooltip:{valueSuffix:" 元"}}),d.packageMovieRevenue.forEach(function(a,b){b<7&&l.charts.series[2].data.push(a),l.dataSet[b].d=a}),c.resolve()):(alert(d.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){l.loadingChart2=!1}),c.promise}();break;case 3:!function(){var d=0;switch(l.other.forEach(function(a,b){1==a.show&&(d=b)}),d){case 0:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getActiveStatisticsInfo",endTime:10==l.searchDate.length?l.searchDate+" 00:00:00":l.searchDate+":00",project:[h.getParams("project")],timespans:l.selectDur,type:l.selectGra});l.loadingChart3=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var d=a.data;"200"==d.rescode?(l.th=["日期","活跃时长","活跃终端数"],l.dataSet=[],l.charts.xAxis.categories=[],l.charts.series=[],d.timeList.forEach(function(a,c){c<7&&l.charts.xAxis.categories.push(b.dtSubstr(a,l.selectGra)),l.dataSet.push({a:b.dtSubstr(a,l.selectGra)})}),l.charts.series.push({name:"活跃时长",data:[],tooltip:{valueSuffix:" 小时"}}),d.totalActiveTime.forEach(function(a,b){function c(a){return a<10&&(a+="0"),a}b<7&&l.charts.series[0].data.push(Number((a/3600).toFixed(2)));var d=Math.floor(a/3600),e=Math.floor((a-3600*d)/60),f=a-3600*d-60*e;l.dataSet[b].b=d+":"+c(e)+":"+c(f)}),d.activeCount.forEach(function(a,b){l.dataSet[b].c=a}),c.resolve()):(alert(d.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){l.loadingChart3=!1}),c.promise}()}}()}},l.changeOrderby=function(a){l.desc=!l.desc}}])}(),function(){angular.module("app.directives",[]).directive("fileModel",["$parse","CONFIG",function(a,b){return{restrict:"A",link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.bind("change",function(){b.$apply(function(){f(b,c[0].files[0])}),"none"!=d.e&&document.getElementById(d.e).click()})}}}])}(),function(){angular.module("app.services",[]).factory("util",["$cookies","$translate","CONFIG",function(a,b,c){return{getApiUrl:function(a,b,d){return d?"server"==d?c.serverUrl+a:c.testUrl+b:c.test?c.testUrl+b:c.serverUrl+a},getUploadUrl:function(){return c.uploadUrl},setParams:function(b,c){a.put(b,JSON.stringify(c))},getParams:function(b){return!!a.get(b)&&JSON.parse(a.get(b))},langStyle:function(){return b.proposedLanguage()||b.use()},getDefaultLangCode:function(){var b=[];a.get("editLangs")&&(b=JSON.parse(a.get("editLangs")));for(var c=0;c<b.length;c++)if(b[c].default)return b[c].code},uploadFileToUrl:function(a,b,c,d,e,f,g){var d=d?d:"normal",h=new FormData;h.append("action",d),h.append("file",b),a.open("POST",c,!0),a.upload.addEventListener("progress",function(a){e(a)},!1),a.onreadystatechange=function(b){4==a.readyState&&200==a.status&&""!=a.responseText?(console.log(JSON.parse(a.responseText)),0!==JSON.parse(a.responseText).result?g(a):f(a)):200!=a.status&&a.responseText&&g(a)},a.send(h)}}}])}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["CONFIG",function(a){return function(){return a.test?"GET":"POST"}}]).filter("fenToYuan",function(){return function(a){var b=a+"";return 1==b.length?b="00"+b:2==b.length&&(b="0"+b),b.slice(0,-2)+"."+b.slice(-2)}}).filter("subtitlePercentComplete",function(){return function(a){return a?"失败"==a?a:a+"%":"无"}})}();