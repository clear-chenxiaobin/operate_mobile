/*! openvod | emma | ISC */

"use strict";!function(){angular.module("app.controllers",[]).controller("indexController",["$scope",function(a){this.init=function(){this.maskUrl=""}}]).controller("loginController",["$scope","$http","$state","$filter","md5","util",function(a,b,c,d,e,f){var g=this;g.init=function(){},g.login=function(){g.loading=!0;var a=JSON.stringify({username:g.userName,password:e.createHash(g.password)});b({method:"POST",url:f.getApiUrl("v1/logon","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(f.setParams("userName",g.userName),f.setParams("token",b.token),g.getEditLangs()):alert(b.rescode+" "+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})},g.getEditLangs=function(){b({method:"GET",url:f.getApiUrl("","editLangs.json","local")}).then(function(a){f.setParams("editLangs",a.data.editLangs),c.go("app.home")},function(a){})}}]).controller("appController",["$http","$scope","$state","$stateParams","$q","$filter","util","CONFIG",function(a,b,c,d,e,f,g,h){var i=this;i.init=function(){i.maskUrl="",i.maskParams={},b.granularity=[{id:0,name:"日"},{id:1,name:"周"},{id:2,name:"月"},{id:3,name:"年"}],b.dateRangeStart=f("date")(new Date,"yyyy-MM-dd"),b.dateRangeEnd=f("date")(new Date,"yyyy-MM-dd"),b.showDate=!1,b.category=0,b.dateType=0},i.showHideMask=function(a,c){a?(b.app.maskUrl=c,b.app.showMaskClass=!0):(b.app.maskUrl="",b.app.showMaskClass=!1)},b.getProject=function(){var c=e.defer(),d=JSON.stringify({token:g.getParams("token"),action:"realProjectNameList"});a({method:"POST",url:g.getApiUrl("v1/project","","server"),data:d}).then(function(a){var d=a.data;"200"==d.rescode?(b.app.projectList=[],b.app.projectList[0]={projectName:"all",projectNameCHZ:"所有项目"},d.data.forEach(function(a){b.app.projectList.push({projectName:a.ProjectName,projectNameCHZ:a.ProjectNameCHZ})}),b.app.selectProject="all",g.setParams("project","all"),c.resolve()):(alert(d.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){})}}]).controller("homeController",["$http","$scope","$state","$location","$filter","$stateParams","$q","util","CONFIG",function(a,b,c,d,e,f,g,h,i){var j=this;j.init=function(){j.projectList=[{projectName:"OpenVoD",projectNameCHZ:"OpenVoD"}],j.selectProject="OpenVoD",j.username=h.getParams("userName")},j.logout=function(){h.setParams("token",""),c.go("login")}}]).controller("overviewController",["$http","$scope","$state","$location","$filter","$stateParams","$q","util","CONFIG",function(a,b,c,d,e,f,g,h,i){function j(){b.$broadcast("start-date-changed")}function k(){b.$broadcast("end-date-changed")}function l(a,c){if(b.dateRangeEnd){var d=moment(b.dateRangeEnd).subtract(0,a).add(1,"minute");c.filter(function(a){return a.localDateValue()>=d.valueOf()}).forEach(function(a){a.selectable=!1})}}function m(a,c){if(b.dateRangeStart){var d=moment(b.dateRangeStart).subtract(1,a).add(1,"minute"),e=(new Date).getTime();c.filter(function(a){return a.localDateValue()<=d.valueOf()||a.localDateValue()>=e.valueOf()}).forEach(function(a){a.selectable=!1})}}var n=this;n.init=function(){n.activerow=0,n.selectGra=1,n.selectDur=7,n.loadData()},moment.locale("zh-cn"),b.endDateBeforeRender=m,b.endDateOnSetTime=k,b.startDateBeforeRender=l,b.startDateOnSetTime=j,n.isCurrent=function(a){n.activerow!=a&&(n.activerow=a,n.loadData())},n.categoryChange=function(){4==b.category?b.showDate=!0:b.showDate=!1,n.loadData()},n.changeGra=function(a){n.loadData()},n.changeProject=function(a){h.setParams("project",a),n.loadChart()},n.charts={chart:{type:"areaspline"},title:{text:""},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:0,y:0,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:[],tickInterval:1},yAxis:{title:{text:""}},tooltip:{shared:!0,valueSuffix:""},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[]},n.loadData=function(){var c=g.defer();switch(n.activerow){case 0:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getTermOnlineRateInfo",StartTime:b.dateRangeStart+" 00:00:00",EndTime:b.dateRangeEnd+" 00:00:00",project:[h.getParams("project")],type:0==b.showDate?0:1,category:0==b.showDate?b.category:b.dateType});n.loadingChart=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var b=a.data;return"200"==b.rescode?(n.th=["日期","上线终端","累计终端","开机率"],n.dataSet=[],n.charts.xAxis.categories=[],n.charts.series=[],b.timeList.forEach(function(a,b){n.charts.xAxis.categories.push(n.dtSubstr(a)),n.dataSet.push({a:n.dtSubstr(a)})}),b.onlineCount.forEach(function(a,b){n.dataSet[b].b=a}),b.totalCount.forEach(function(a,b){n.dataSet[b].c=a}),n.charts.series.push({name:"开机率",id:"series-0",data:[],tooltip:{valueSuffix:"%"}}),b.onlineRate.forEach(function(a,b){n.charts.series[0].data.push(h.FloatMul(a,100)),n.dataSet[b].d=h.FloatMul(a,100)+"%"}),c.resolve()):(alert(b.errInfo),c.reject()),c.promise},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){n.loadingChart=!1})}();break;case 1:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getTermActiveRateInfo",StartTime:b.dateRangeStart+" 00:00:00",EndTime:b.dateRangeEnd+" 00:00:00",project:[h.getParams("project")],type:0==b.showDate?0:1,category:0==b.showDate?b.category:b.dateType});n.loadingChart=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(n.th=["日期","活跃终端","上线终端","活跃率"],n.dataSet=[],n.charts.xAxis.categories=[],n.charts.series=[],b.timeList.forEach(function(a,b){n.charts.xAxis.categories.push(n.dtSubstr(a)),n.dataSet.push({a:n.dtSubstr(a)})}),b.activeCount.forEach(function(a,b){n.dataSet[b].b=a}),b.onlineCount.forEach(function(a,b){n.dataSet[b].c=a}),n.charts.series.push({name:"活跃率",id:"series-0",data:[],tooltip:{valueSuffix:"%"}}),b.activeRate.forEach(function(a,b){n.charts.series[0].data.push(h.FloatMul(a,100)),n.dataSet[b].d=h.FloatMul(a,100)+"%"}),c.resolve()):(alert(b.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){n.loadingChart=!1})}();break;case 2:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getTermPayRateInfo",StartTime:b.dateRangeStart+" 00:00:00",EndTime:b.dateRangeEnd+" 00:00:00",project:[h.getParams("project")],type:0==b.showDate?0:1,category:0==b.showDate?b.category:b.dateType});n.loadingChart=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(n.th=["日期","活跃终端","付费终端","付费终端转化率"],n.dataSet=[],n.charts.xAxis.categories=[],n.charts.series=[],b.timeList.forEach(function(a,b){n.charts.xAxis.categories.push(n.dtSubstr(a)),n.dataSet.push({a:n.dtSubstr(a)})}),b.payCount.forEach(function(a,b){n.dataSet[b].b=a}),b.activeCount.forEach(function(a,b){n.dataSet[b].c=a}),n.charts.series.push({name:"终端付费转化率",data:[],tooltip:{valueSuffix:"%"}}),b.payRate.forEach(function(a,b){n.charts.series[0].data.push(h.FloatMul(a,100)),n.dataSet[b].d=h.FloatMul(a,100)+"%"}),c.resolve()):(alert(b.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){n.loadingChart=!1})}();break;case 3:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getPerTermRevenueInfo",StartTime:b.dateRangeStart+" 00:00:00",EndTime:b.dateRangeEnd+" 00:00:00",project:[h.getParams("project")],type:0==b.showDate?0:1,category:0==b.showDate?b.category:b.dateType});n.loadingChart=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(n.th=["日期","总营收","总终端数","平均营收"],n.dataSet=[],n.charts.xAxis.categories=[],n.charts.series=[],b.timeList.forEach(function(a,b){n.charts.xAxis.categories.push(n.dtSubstr(a)),n.dataSet.push({a:n.dtSubstr(a)})}),b.totalMoney.forEach(function(a,b){n.dataSet[b].b=a}),b.totalCount.forEach(function(a,b){n.dataSet[b].c=a}),n.charts.series.push({name:"平均每终端营收",data:[],tooltip:{valueSuffix:" 元"}}),b.revenue.forEach(function(a,b){n.charts.series[0].data.push(a),n.dataSet[b].d=a}),c.resolve()):(alert(b.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){n.loadingChart=!1})}();break;case 4:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getPerTermActiveTimeInfo",StartTime:b.dateRangeStart+" 00:00:00",EndTime:b.dateRangeEnd+" 00:00:00",project:[h.getParams("project")],type:0==b.showDate?0:1,category:0==b.showDate?b.category:b.dateType});n.loadingChart=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(n.th=["日期","总活跃时长","总终端数","平均活跃时长"],n.dataSet=[],n.charts.xAxis.categories=[],n.charts.series=[],b.timeList.forEach(function(a,b){n.charts.xAxis.categories.push(n.dtSubstr(a)),n.dataSet.push({a:n.dtSubstr(a)})}),b.activeTime.forEach(function(a,b){n.dataSet[b].b=a}),b.activeCount.forEach(function(a,b){n.dataSet[b].c=a}),n.charts.series.push({name:"平均活跃时长",data:[],tooltip:{valueSuffix:" 小时"}}),b.perActiveTime.forEach(function(a,b){function c(a){return a<10&&(a="0"+a),a}n.charts.series[0].data.push(Number((a/3600).toFixed(2)));var d=Math.floor(a/3600),e=Math.floor((a-3600*d)/60),f=(a-3600*d-60*e).toFixed(2);n.dataSet[b].d=d+":"+c(e)+":"+c(f)}),c.resolve()):(alert(b.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){n.loadingChart=!1})}()}return c.promise},n.changeOrderby=function(a){n.desc=!n.desc},n.dtSubstr=function(a){if(0==b.showDate)switch(b.category){case 0:return a.substring(5,16);case 1:case 2:return a.substring(5,10);case 3:return a.substring(0,7)}else switch(b.dateType){case 0:case 1:return a.substring(5,10);case 2:return a.substring(5,7);case 3:return a.substring(0,4)}}}]).controller("specificController",["$http","$scope","$state","$location","$filter","$stateParams","$q","util","CONFIG",function(a,b,c,d,e,f,g,h,i){function j(){b.$broadcast("start-date-changed")}function k(){b.$broadcast("end-date-changed")}function l(a,c){if(b.dateRangeEnd){var d=moment(b.dateRangeEnd).subtract(0,a).add(1,"minute");c.filter(function(a){return a.localDateValue()>=d.valueOf()}).forEach(function(a){a.selectable=!1})}}function m(a,c){if(b.dateRangeStart){var d=moment(b.dateRangeStart).subtract(1,a).add(1,"minute"),e=(new Date).getTime();c.filter(function(a){return a.localDateValue()<=d.valueOf()||a.localDateValue()>=e.valueOf()}).forEach(function(a){a.selectable=!1})}}var n=this;n.init=function(){n.activerow=0,n.term=[{name:"累计终端",show:!0,sort:"",desc:!1},{name:"上线终端",show:!0,sort:"",desc:!1},{name:"活跃终端",show:!0,sort:"",desc:!1},{name:"付费终端",show:!0,sort:"",desc:!1},{name:"新增终端",show:!1,sort:"",desc:!1}],n.countStatistics=[{name:"总",show:!0,sort:"",desc:!1},{name:"单次",show:!1,sort:"",desc:!1},{name:"打包",show:!1,sort:"",desc:!1}],n.selectCount=3,n.active=[{name:"活跃时长",show:!0,sort:"",desc:!1},{name:"活跃终端",show:!1,sort:"",desc:!1},{name:"营 收 额",show:!1,sort:"",desc:!1}],n.loadData(),n.orderby={},n.orderby.desc=!1},moment.locale("zh-cn"),b.endDateBeforeRender=m,b.endDateOnSetTime=k,b.startDateBeforeRender=l,b.startDateOnSetTime=j,n.isCurrent=function(a){n.activerow!=a&&(n.activerow=a,n.loadData())},n.changeProject=function(a){h.setParams("project",a),n.loadData()},n.categoryChange=function(){4==b.category?b.showDate=!0:b.showDate=!1,n.loadData()},n.changeGra=function(a){n.loadData()},n.selectTerm=function(a){if(1==n.term[a].show&&n.selectCount>=2)n.selectCount--;else{if(1==n.term[a].show&&n.selectCount<2)return alert("最少选择1组数据！"),!1;if(!(0==n.term[a].show&&n.selectCount<4))return alert("最多只能选择4组显示！"),!1;n.selectCount++}n.term[a].show=!n.term[a].show,n.th=["日期"],n.charts.series=[];var b=0;n.term.forEach(function(a,c){1==a.show&&(n.th.push(a.name),n.termSeries[c].id="series-"+b,n.charts.series.push(n.termSeries[c]),b++)}),n.dataSet=[],n.termData.forEach(function(a,b){n.dataSet.push({a:a.a}),1==n.term[0].show&&(n.dataSet[b].b=a.b),1==n.term[1].show&&(n.dataSet[b].c=a.c),1==n.term[2].show&&(n.dataSet[b].d=a.d),1==n.term[3].show&&(n.dataSet[b].e=a.e),1==n.term[4].show&&(n.dataSet[b].f=a.f)})},n.selectCountStatistics=function(a){0==n.countStatistics[a].show&&n.countStatistics.forEach(function(b,c){b.show=c==a}),1==n.countStatistics[0].show?(n.th=["日期","总下单数","总支付数"],n.charts.series=n.PaySeries0,n.dataSet=n.PayData0):1==n.countStatistics[1].show?(n.th=["日期","单次下单数","单次支付数"],n.charts.series=n.PaySeries1,n.dataSet=n.PayData1):1==n.countStatistics[2].show&&(n.th=["日期","打包下单数","打包支付数"],n.charts.series=n.PaySeries2,n.dataSet=n.PayData2)},n.selectActive=function(a){n.active.forEach(function(a){a.show=!1}),n.active[a].show=!0,n.loadData()},n.charts={chart:{type:"areaspline"},title:{text:""},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:0,y:0,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:[]},yAxis:{title:{text:""}},tooltip:{shared:!0,valueSuffix:""},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[]},n.loadData=function(){var c=g.defer();switch(n.activerow){case 0:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getTermStatisticsInfo",StartTime:b.dateRangeStart+" 00:00:00",EndTime:b.dateRangeEnd+" 00:00:00",project:[h.getParams("project")],type:0==b.showDate?0:1,category:0==b.showDate?b.category:b.dateType});n.loadingChart=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var b=a.data;if("200"==b.rescode){n.dataSet=[],n.charts.xAxis.categories=[],n.charts.series=[],n.termSeries=[],n.termData=[],b.timeList.forEach(function(a,b){n.charts.xAxis.categories.push(n.dtSubstr(a)),n.termData.push({a:n.dtSubstr(a)})}),n.termSeries.push({name:"累计终端",data:[],tooltip:{valueSuffix:" 个"}}),b.addUpCount.forEach(function(a,b){n.termSeries[0].data.push(a),n.termData[b].b=a}),n.termSeries.push({name:"上线终端",data:[],tooltip:{valueSuffix:" 个"}}),b.onlineCount.forEach(function(a,b){n.termSeries[1].data.push(a),n.termData[b].c=a}),n.termSeries.push({name:"活跃终端",data:[],tooltip:{valueSuffix:" 个"}}),b.activeCount.forEach(function(a,b){n.termSeries[2].data.push(a),n.termData[b].d=a}),n.termSeries.push({name:"付费终端",data:[],tooltip:{valueSuffix:" 个"}}),b.payCount.forEach(function(a,b){n.termSeries[3].data.push(a),n.termData[b].e=a}),n.termSeries.push({name:"新增终端",data:[],tooltip:{valueSuffix:" 个"}}),b.newAddCount.forEach(function(a,b){n.termSeries[4].data.push(a),n.termData[b].f=a}),n.th=["日期"];var d=0;n.term.forEach(function(a,b){1==a.show&&(n.th.push(a.name),n.termSeries[b].id="series-"+d,n.charts.series.push(n.termSeries[b]),d++)}),n.termData.forEach(function(a,b){n.dataSet.push({a:a.a}),1==n.term[0].show&&(n.dataSet[b].b=a.b),1==n.term[1].show&&(n.dataSet[b].c=a.c),1==n.term[2].show&&(n.dataSet[b].d=a.d),1==n.term[3].show&&(n.dataSet[b].e=a.e),1==n.term[4].show&&(n.dataSet[b].f=a.f)}),c.resolve()}else alert(b.errInfo),c.reject()},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){n.loadingChart=!1}),c.promise}();break;case 1:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getPayCountStatisticsInfo",StartTime:b.dateRangeStart+" 00:00:00",EndTime:b.dateRangeEnd+" 00:00:00",project:[h.getParams("project")],type:0==b.showDate?0:1,category:0==b.showDate?b.category:b.dateType});n.loadingChart=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(n.PaySeries0=[],n.PaySeries1=[],n.PaySeries2=[],n.PayData0=[],n.PayData1=[],n.PayData2=[],n.dataSet=[],n.charts.xAxis.categories=[],n.charts.series=[],b.timeList.forEach(function(a,b){n.charts.xAxis.categories.push(n.dtSubstr(a)),n.PayData0.push({a:n.dtSubstr(a)}),n.PayData1.push({a:n.dtSubstr(a)}),n.PayData2.push({a:n.dtSubstr(a)})}),n.PaySeries0.push({name:"总下单数",id:"series-0",data:[],tooltip:{valueSuffix:" 单"}}),b.wantPayCount.forEach(function(a,b){n.PaySeries0[0].data.push(a),n.PayData0[b].b=a}),n.PaySeries0.push({name:"总支付数",id:"series-1",data:[],tooltip:{valueSuffix:" 单"}}),b.payCount.forEach(function(a,b){n.PaySeries0[1].data.push(a),n.PayData0[b].c=a}),n.PaySeries1.push({name:"单次下单数",id:"series-0",data:[],tooltip:{valueSuffix:" 单"}}),b.wantPaySingleCount.forEach(function(a,b){n.PaySeries1[0].data.push(a),n.PayData1[b].b=a}),n.PaySeries1.push({name:"单次支付数",id:"series-1",data:[],tooltip:{valueSuffix:" 单"}}),b.paySingleCount.forEach(function(a,b){n.PaySeries1[1].data.push(a),n.PayData1[b].c=a}),n.PaySeries2.push({name:"打包下单数",id:"series-0",data:[],tooltip:{valueSuffix:" 单"}}),b.wantPayPackageCount.forEach(function(a,b){n.PaySeries2[0].data.push(a),n.PayData2[b].b=a}),n.PaySeries2.push({name:"打包支付数",id:"series-1",data:[],tooltip:{valueSuffix:" 单"}}),b.payPackageCount.forEach(function(a,b){n.PaySeries2[1].data.push(a),n.PayData2[b].c=a}),1==n.countStatistics[0].show?(n.th=["日期","总下单数","总支付数"],n.charts.series=n.PaySeries0,n.dataSet=n.PayData0):1==n.countStatistics[1].show?(n.th=["日期","单次下单数","单次支付数"],n.charts.series=n.PaySeries1,n.dataSet=n.PayData1):1==n.countStatistics[2].show&&(n.th=["日期","打包下单数","打包支付数"],n.charts.series=n.PaySeries2,n.dataSet=n.PayData2),c.resolve()):(alert(b.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){n.loadingChart=!1}),c.promise}();break;case 2:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getRevenueStatisticsInfo",StartTime:b.dateRangeStart+" 00:00:00",EndTime:b.dateRangeEnd+" 00:00:00",project:[h.getParams("project")],type:0==b.showDate?0:1,category:0==b.showDate?b.category:b.dateType});n.loadingChart=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(n.th=["日期","总收益","单次点播收益","打包点播收益"],n.dataSet=[],n.charts.xAxis.categories=[],n.charts.series=[],b.timeList.forEach(function(a,b){n.charts.xAxis.categories.push(n.dtSubstr(a)),n.dataSet.push({a:n.dtSubstr(a)})}),n.charts.series.push({name:"总收益",data:[],tooltip:{valueSuffix:" 元"}}),b.totalMovieRevenue.forEach(function(a,b){n.charts.series[0].data.push(a/100),n.dataSet[b].b=a/100}),n.charts.series.push({name:"单次点播收益",data:[],tooltip:{valueSuffix:" 元"}}),b.singleMovieRevenue.forEach(function(a,b){n.charts.series[1].data.push(a/100),n.dataSet[b].c=a/100}),n.charts.series.push({name:"打包点播收益",data:[],tooltip:{valueSuffix:" 元"}}),b.packageMovieRevenue.forEach(function(a,b){n.charts.series[2].data.push(a/100),n.dataSet[b].d=a/100}),c.resolve()):(alert(b.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){n.loadingChart=!1}),c.promise}();break;case 3:!function(){var d=JSON.stringify({token:h.getParams("token"),action:"getActiveStatisticsInfo",StartTime:b.dateRangeStart+" 00:00:00",EndTime:b.dateRangeEnd+" 00:00:00",project:[h.getParams("project")],type:0==b.showDate?0:1,category:0==b.showDate?b.category:b.dateType});n.loadingChart=!0,a({method:"POST",url:h.getApiUrl("v2/statistics","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(n.activeSeries0=[],n.activeSeries1=[],n.th=["日期","活跃时长","活跃终端数"],n.dataSet=[],n.charts.xAxis.categories=[],n.charts.series=[],b.timeList.forEach(function(a,b){n.charts.xAxis.categories.push(n.dtSubstr(a)),n.dataSet.push({a:n.dtSubstr(a)})}),n.activeSeries0.push({name:"活跃时长",id:"series-0",data:[],tooltip:{valueSuffix:" 小时"}}),b.totalActiveTime.forEach(function(a,b){function c(a){return a<10&&(a="0"+a),a}n.activeSeries0[0].data.push(Number((a/3600).toFixed(2)));var d=Math.floor(a/3600),e=Math.floor((a-3600*d)/60),f=a-3600*d-60*e;n.dataSet[b].b=d+":"+c(e)+":"+c(f)}),n.activeSeries1.push({name:"活跃终端数",id:"series-0",data:[],tooltip:{valueSuffix:" 个"}}),b.activeCount.forEach(function(a,b){n.activeSeries1[0].data.push(a),n.dataSet[b].c=a}),1==n.active[0].show?n.charts.series=n.activeSeries0:1==n.active[1].show&&(n.charts.series=n.activeSeries1),c.resolve()):(alert(b.errInfo),c.reject())},function(a){alert("连接服务器出错"),c.reject()}).finally(function(a){n.loadingChart=!1}),c.promise}()}},n.changeOrderby=function(a){n.desc=!n.desc},n.dtSubstr=function(a){if(0==b.showDate)switch(b.category){case 0:return a.substring(5,16);case 1:case 2:return a.substring(5,10);case 3:return a.substring(0,7)}else switch(b.dateType){case 0:case 1:return a.substring(5,10);case 2:return a.substring(5,7);case 3:return a.substring(0,4)}}}]).controller("projectController",["$http","$scope","$state","$location","$filter","$stateParams","$q","util","CONFIG",function(a,b,c,d,e,f,g,h,i){var j=this;j.changeProbability=function(a,b){h.setParams("probabilityName",a),h.setParams("index",b),console.log(h.getParams("probabilityName"),b),b<5?console.log("<5"):console.log(">5"),c.go("app.project2")},j.changeTermShow=function(){j.term.forEach(function(a,b){a.show=!a.show})},j.changeOrderShow=function(){j.order.forEach(function(a,b){a.show=!a.show})},j.changeRevenueShow=function(){j.revenue.forEach(function(a,b){a.show=!a.show})},j.init=function(){j.current=h.getParams("probabilityName"),j.probability=[{name:"开机率",show:!1,sort:"",desc:!1},{name:"活跃率",show:!1,sort:"",desc:!1},{name:"付费转化",show:!1,sort:"",desc:!1},{name:"平均营收",show:!1,sort:"",desc:!1},{name:"平均活跃",show:!1,sort:"",desc:!1}],j.term=[{name:"累计终端",show:!1,sort:"",desc:!1},{name:"上线终端",show:!1,sort:"",desc:!1},{name:"活跃终端",show:!1,sort:"",desc:!1},{name:"付费终端",show:!1,sort:"",desc:!1},{name:"新增终端",show:!1,sort:"",desc:!1}],j.order=[{name:"订单总数",show:!1,sort:"",desc:!1},{name:"单次订单数",show:!1,sort:"",desc:!1},{name:"打包订单数",show:!1,sort:"",desc:!1}],j.revenue=[{name:"营收总额",show:!1,sort:"",desc:!1},{name:"单次营收额",show:!1,sort:"",desc:!1},{name:"打包营收额",show:!1,sort:"",desc:!1}]}}]).controller("project2Controller",["$http","$scope","$state","$location","$filter","$stateParams","md5","$q","util","CONFIG",function(a,b,c,d,e,f,g,h,i,j){function k(){b.$broadcast("start-date-changed")}function l(){b.$broadcast("end-date-changed")}function m(a,c){if(b.dateRangeEnd){var d=moment(b.dateRangeEnd).subtract(0,a).add(1,"minute");c.filter(function(a){return a.localDateValue()>=d.valueOf()}).forEach(function(a){a.selectable=!1})}}function n(a,c){if(b.dateRangeStart){var d=moment(b.dateRangeStart).subtract(1,a).add(1,"minute"),e=(new Date).getTime();c.filter(function(a){return a.localDateValue()<=d.valueOf()||a.localDateValue()>=e.valueOf()}).forEach(function(a){a.selectable=!1})}}var o=this;b.showDate=!0,b.endDateBeforeRender=n,b.endDateOnSetTime=l,b.startDateBeforeRender=m,b.startDateOnSetTime=k,o.loadChart=function(c){var d=h.defer();switch(c){case 0:!function(){o.th=["项目名称","累计终端","上线终端","开机率"],o.charts.series[0].name="开机率",o.charts.tooltip.valueSuffix="%",o.charts.xAxis.categories=[],o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectOnlineRateInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});console.log(JSON.parse(c).StartTime),console.log(JSON.parse(c).EndTime),a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if(console.log(b),"200"==b.rescode){for(var c=0;c<b.projectListCHZ.length;c++)o.dataSet.push({b:b.projectListCHZ[c],c:b.totalCount[c],d:b.onlineCount[c],e:parseInt(100*b.onlineRate[c])+"%"});for(var d=o.dataSet.length>5?5:o.dataSet.length,c=0;c<d;c++)o.charts.xAxis.categories.push(o.dataSet[c].b),o.charts.series[0].data.push(parseFloat(o.dataSet[c].e))}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 1:!function(){o.th=["项目名称","上线终端","活跃终端","活跃率"],o.charts.series[0].name="活跃率",o.charts.tooltip.valueSuffix="%",o.charts.xAxis.categories=[],o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectActiveRateInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if(console.log(b),"200"==b.rescode){for(var c=0;c<b.projectListCHZ.length;c++)o.dataSet.push({b:b.projectListCHZ[c],c:b.onlineCount[c],d:b.activeCount[c],e:parseInt(100*b.activeRate[c])+"%"});for(var d=o.dataSet.length>5?5:o.dataSet.length,c=0;c<d;c++)o.charts.xAxis.categories.push(o.dataSet[c].b),o.charts.series[0].data.push(parseFloat(o.dataSet[c].e))}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 2:!function(){o.th=["项目名称","活跃终端","付费终端","付费转化"],o.charts.series[0].name="付费转化",o.charts.tooltip.valueSuffix="%",o.charts.xAxis.categories=[],o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectPayRateInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if(console.log(b),"200"==b.rescode){for(var c=0;c<b.projectListCHZ.length;c++)o.dataSet.push({b:b.projectListCHZ[c],c:b.activeCount[c],d:b.payCount[c],e:parseInt(100*b.payRate[c])+"%"});for(var d=o.dataSet.length>5?5:o.dataSet.length,c=0;c<d;c++)o.charts.xAxis.categories.push(o.dataSet[c].b),o.charts.series[0].data.push(parseFloat(o.dataSet[c].e))}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 3:!function(){o.th=["项目名称","上线终端","营收总额","平均营收(分)"],o.charts.series[0].name="平均营收",o.charts.tooltip.valueSuffix="分",o.charts.xAxis.categories=[],o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectPerRevenueInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if(console.log(b),"200"==b.rescode){for(var c=0;c<b.projectListCHZ.length;c++)o.dataSet.push({b:b.projectListCHZ[c],c:b.onlineCount[c],d:b.allMoney[c],e:b.perRevenue[c]});for(var d=o.dataSet.length>5?5:o.dataSet.length,c=0;c<d;c++)o.charts.xAxis.categories.push(o.dataSet[c].b),o.charts.series[0].data.push(parseFloat(o.dataSet[c].e))}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 4:!function(){o.th=["项目名称","活跃终端","活跃时长","平均活跃时长(h)"],o.charts.series[0].name="平均活跃时长",o.charts.tooltip.valueSuffix="h",o.charts.xAxis.categories=[],o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectPerActiveInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if(console.log(b),"200"==b.rescode){for(var c=0;c<b.projectListCHZ.length;c++)o.dataSet.push({b:b.projectListCHZ[c],c:b.activeCount[c],d:(b.avgAllActiveTime[c]/3600).toFixed(2),e:(b.avgActiveTime[c]/3600).toFixed(2)});for(var d=o.dataSet.length>5?5:o.dataSet.length,c=0;c<d;c++)o.charts.xAxis.categories.push(o.dataSet[c].b),o.charts.series[0].data.push(parseFloat(o.dataSet[c].e))}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 5:!function(){console.log("加载累计终端数据……"),o.th=["项目名称","累计终端"],o.charts.series[0].name="累计终端",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectAddUpInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.addUpCount[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.addUpCount[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 6:!function(){console.log("加载上线终端数据……"),o.th=["项目名称","上线终端"],o.charts.series[0].name="上线终端",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectOnlineInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.onlineCount[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.onlineCount[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 7:!function(){console.log("加载活跃终端数据……"),o.th=["项目名称","活跃终端"],o.charts.series[0].name="活跃终端",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectActiveInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.activeCount[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.activeCount[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 8:!function(){o.th=["项目名称","付费终端"],o.charts.series[0].name="付费终端",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectPayedInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.payedCount[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.payedCount[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 9:!function(){o.th=["项目名称","新增终端"],o.charts.series[0].name="新增终端",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectNewAddInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.newAddCount[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.newAddCount[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 10:!function(){o.th=["项目名称","订单总数"],o.charts.series[0].name="订单总数",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectOrderCountInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.orderCount[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.orderCount[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break
;case 11:!function(){o.th=["项目名称","单次订单数"],o.charts.series[0].name="单次订单数",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectSingleOrderCountInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.orderCount[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.orderCount[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 12:!function(){o.th=["项目名称","打包订单数"],o.charts.series[0].name="新增终端",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectSingleOrderCountInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.orderCount[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.orderCount[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 13:!function(){o.th=["项目名称","营收总额(分)"],o.charts.series[0].name="营收总额",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectRevenueInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.revenue[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.revenue[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 14:!function(){o.th=["项目名称","单次营收额(分)"],o.charts.series[0].name="单次营收额",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectSingleRevenueInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.revenue[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.revenue[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}();break;case 15:!function(){o.th=["项目名称","打包营收额(分)"],o.charts.series[0].name="打包营收额",o.charts.series[0].data=[],o.dataSet=[];var c=JSON.stringify({token:i.getParams("token"),action:"getSortedProjectPackageRevenueInfo",StartTime:b.dateRangeStart,EndTime:b.dateRangeEnd,page:1,per_page:1e3,project:["all"]});a({method:"POST",url:i.getApiUrl("v2/statistics","","server"),data:c}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=0,d=0;d<b.projectListCHZ.length;d++)c+=b.revenue[d],o.dataSet.push({b:b.projectListCHZ[d],c:b.revenue[d]});o.dataSet.forEach(function(a,b){b<5&&(c-=a.c,0==b?o.charts.series[0].data.push({name:a.b,y:a.c,sliced:!0,selected:!0}):o.charts.series[0].data.push([a.b,a.c]))}),0!=c&&o.charts.series[0].data.push(["其他",c])}},function(a){alert("连接服务器出错"),d.reject()}).finally(function(a){})}()}},o.changeTermShow=function(){o.term.forEach(function(a,b){a.show=!a.show})},o.changeOrderShow=function(){o.order.forEach(function(a,b){a.show=!a.show})},o.changeRevenueShow=function(){o.revenue.forEach(function(a,b){a.show=!a.show})},o.init=function(){o.current=i.getParams("probabilityName"),o.indexNum=i.getParams("index"),o.showClass=!0,o.indexNum<5?o.charts={chart:{type:"bar"},title:{text:""},legend:{backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:[],tickPixelInterval:5},yAxis:{title:{text:"",align:"high"}},tooltip:{shared:!0,valueSuffix:""},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5},series:{groupPadding:.4,borderRadius:4,colorByPoint:!0}},series:[{name:"",data:[]}]}:(o.showClass=!1,o.charts={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:""},tooltip:{headerFormat:"{series.name}<br>",pointFormat:"{point.name}: <b>{point.percentage:.1f}%</b>"},legend:{},credits:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",connectorColor:"silver"},showInLegend:!0}},series:[{type:"pie",name:"",data:[]}]}),console.log("当前index：",o.indexNum),o.loadChart(o.indexNum),o.orderby={},o.orderby.desc=!0},o.changeOrderby=function(a){o.desc=!o.desc},o.dtSubstr=function(a){if(0==b.showDate)switch(b.category){case 0:return a.substring(11,16);case 1:return a.substring(5,10);case 2:return a.substring(5,7);case 3:return a.substring(0,4)}else switch(b.dateType){case 0:case 1:return a.substring(5,10);case 2:return a.substring(5,7);case 3:return a.substring(0,4)}}}])}(),function(){angular.module("app.directives",[]).directive("fileModel",["$parse","CONFIG",function(a,b){return{restrict:"A",link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.bind("change",function(){b.$apply(function(){f(b,c[0].files[0])}),"none"!=d.e&&document.getElementById(d.e).click()})}}}])}(),function(){angular.module("app.services",[]).factory("util",["$cookies","$translate","CONFIG",function(a,b,c){return{getApiUrl:function(a,b,d){return d?"server"==d?c.serverUrl+a:c.testUrl+b:c.test?c.testUrl+b:c.serverUrl+a},getUploadUrl:function(){return c.uploadUrl},setParams:function(b,c){a.put(b,JSON.stringify(c))},getParams:function(b){return!!a.get(b)&&JSON.parse(a.get(b))},langStyle:function(){return b.proposedLanguage()||b.use()},getDefaultLangCode:function(){var b=[];a.get("editLangs")&&(b=JSON.parse(a.get("editLangs")));for(var c=0;c<b.length;c++)if(b[c].default)return b[c].code},uploadFileToUrl:function(a,b,c,d,e,f,g){var d=d||"normal",h=new FormData;h.append("action",d),h.append("file",b),a.open("POST",c,!0),a.upload.addEventListener("progress",function(a){e(a)},!1),a.onreadystatechange=function(b){4==a.readyState&&200==a.status&&""!=a.responseText?(console.log(JSON.parse(a.responseText)),0!==JSON.parse(a.responseText).result?g(a):f(a)):200!=a.status&&a.responseText&&g(a)},a.send(h)},FloatMul:function(a,b){var c=0,d=a.toString(),e=b.toString();try{c+=d.split(".")[1].length}catch(a){}try{c+=e.split(".")[1].length}catch(a){}return Number(d.replace(".",""))*Number(e.replace(".",""))/Math.pow(10,c)}}}])}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["CONFIG",function(a){return function(){return a.test?"GET":"POST"}}]).filter("fenToYuan",function(){return function(a){var b=a+"";return 1==b.length?b="00"+b:2==b.length&&(b="0"+b),b.slice(0,-2)+"."+b.slice(-2)}}).filter("subtitlePercentComplete",function(){return function(a){return a?"失败"==a?a:a+"%":"无"}})}();